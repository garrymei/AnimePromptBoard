<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Prompt Board</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .upload-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .upload-area {
            border: 3px dashed #ddd;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .upload-area:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .upload-area.dragover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .upload-icon {
            font-size: 3rem;
            color: #667eea;
            margin-bottom: 15px;
        }

        .file-input {
            display: none;
        }

        .prompt-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .category-item {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .category-item:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .category-item.selected {
            border-color: #667eea;
            background: #e3f2fd;
        }

        .category-item h4 {
            margin-bottom: 8px;
            color: #495057;
        }

        .category-item p {
            font-size: 0.9rem;
            color: #6c757d;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .import-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 12px 20px;
            cursor: pointer;
            font-size: 1rem;
            color: #6c757d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab-btn:hover {
            color: #495057;
        }

        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
            margin-bottom: 20px;
        }

        .tab-content.active {
            display: block;
        }

        .prompt-input-area {
            margin-bottom: 20px;
        }

        .prompt-input-area label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #495057;
        }

        .prompt-input-area textarea {
            width: 100%;
            min-height: 300px;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        .prompt-input-area textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .prompt-preview {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            min-height: 100px;
        }

        .prompt-preview.empty {
            color: #6c757d;
            text-align: center;
            font-style: italic;
        }

        .preview-category {
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            padding-left: 15px;
        }

        .preview-category h4 {
            color: #495057;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .preview-category .en-text {
            background: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin-bottom: 5px;
            color: #495057;
        }

        .preview-category .zh-text {
            font-size: 0.8rem;
            color: #6c757d;
        }

        .import-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .entry-title-input,
        .entry-tags-input {
            flex: 1;
            min-width: 200px;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .entry-title-input:focus,
        .entry-tags-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .toolbar-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }

        .toolbar-left {
            flex: 2;
            min-width: 400px;
        }

        .toolbar-right {
            flex: 1;
            min-width: 300px;
        }

        .data-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }

        .edit-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .edit-modal.active {
            display: flex;
        }

        .edit-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 900px;
            width: 90%;
            max-height: 90%;
            overflow-y: auto;
        }

        .edit-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 15px;
        }

        .edit-categories {
            display: grid;
            gap: 20px;
            margin-bottom: 20px;
        }

        .edit-category {
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
        }

        .edit-category h4 {
            margin-bottom: 10px;
            color: #495057;
        }

        .edit-textarea {
            width: 100%;
            min-height: 80px;
            padding: 10px;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin-bottom: 10px;
            resize: vertical;
        }

        .edit-textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .edit-zh {
            font-size: 0.8rem;
            color: #6c757d;
            margin-bottom: 10px;
        }

        .copy-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .copy-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .copy-btn:hover {
            background: #218838;
        }

        .tag-editor {
            margin-bottom: 20px;
        }

        .tag-editor h4 {
            margin-bottom: 10px;
        }

        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 10px;
        }

        .tag-chip {
            background: #e3f2fd;
            color: #1976d2;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .tag-remove {
            background: none;
            border: none;
            color: #1976d2;
            cursor: pointer;
            padding: 0;
            font-size: 1rem;
        }

        .tag-input {
            flex: 1;
            min-width: 200px;
            padding: 8px 12px;
            border: 1px solid #e9ecef;
            border-radius: 6px;
        }

        .edit-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            border-top: 2px solid #e9ecef;
            padding-top: 15px;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .search-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .search-row {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 200px;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .tag-filter {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }

        .tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tag:hover {
            background: #bbdefb;
        }

        .tag.selected {
            background: #1976d2;
            color: white;
        }

        .entries-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .entries-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .entry-card {
            border: 2px solid #e9ecef;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            background: white;
        }

        .entry-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .entry-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-bottom: 1px solid #e9ecef;
        }

        .entry-content {
            padding: 20px;
        }

        .entry-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #495057;
        }

        .entry-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 15px;
        }

        .entry-tag {
            background: #f8f9fa;
            color: #6c757d;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
        }

        .prompt-section {
            margin-bottom: 15px;
        }

        .prompt-category {
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .prompt-text {
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            color: #495057;
            margin-bottom: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
            word-break: break-all;
        }

        .prompt-text:hover {
            background: #e9ecef;
        }

        .prompt-chinese {
            font-size: 0.8rem;
            color: #6c757d;
            margin-bottom: 8px;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 30px;
        }

        .page-btn {
            padding: 8px 15px;
            border: 2px solid #e9ecef;
            background: white;
            color: #495057;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .page-btn:hover {
            border-color: #667eea;
            color: #667eea;
        }

        .page-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .stats {
            text-align: center;
            margin-bottom: 20px;
            color: #6c757d;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state h3 {
            margin-bottom: 15px;
            color: #495057;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 10px 15px;
            border-radius: 6px;
            margin: 10px 0;
            border: 1px solid #c3e6cb;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .search-row {
                flex-direction: column;
            }
            
            .entries-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¨ Anime Prompt Board</h1>
            <p>äºŒæ¬¡å…ƒæç¤ºè¯ç®¡ç†å·¥å…· - æœ¬åœ°å­˜å‚¨ï¼Œæ— éœ€ç™»å½•</p>
        </div>

        <!-- å¯¼å…¥åŒºåŸŸ -->
        <div class="upload-section">
            <h3>ğŸ“¤ å¯¼å…¥å›¾ç‰‡ & æç¤ºè¯</h3>
            <div class="import-tabs">
                <button class="tab-btn active" id="imageTab">ğŸ“· é€‰æ‹©å›¾ç‰‡</button>
                <button class="tab-btn" id="promptTab">ğŸ“ è¾“å…¥æç¤ºè¯</button>
            </div>
            
            <!-- å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ -->
            <div class="tab-content active" id="imageContent">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">ğŸ“</div>
                    <p>æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
                    <p style="font-size: 0.9rem; color: #6c757d; margin-top: 10px;">
                        æ”¯æŒ PNG, JPG, JPEG, WebP æ ¼å¼
                    </p>
                </div>
                <input type="file" id="fileInput" class="file-input" accept="image/*" multiple>
            </div>
            
            <!-- æç¤ºè¯è¾“å…¥åŒºåŸŸ -->
            <div class="tab-content" id="promptContent">
                <div class="prompt-input-area">
                    <label for="promptInput">è¾“å…¥8ç±»æç¤ºè¯ï¼ˆæ”¯æŒè‡ªåŠ¨åˆ†ç±»ï¼‰ï¼š</label>
                    <textarea id="promptInput" placeholder="è¯·æŒ‰ä»¥ä¸‹æ ¼å¼è¾“å…¥æç¤ºè¯ï¼š

[Base Styles / åŸºç¡€é£æ ¼]
anime style, bishoujo character, Demon Slayer illustration

[Artistic Styles / ç”»é£è¡¨ç°]
cel shading, manga lineart, vibrant pastel tones

[Cinematic / æ‘„å½±æ„Ÿ]
cinematic composition, dynamic action shot, ultra-realistic rim lighting

[Lighting & Mood / å…‰å½±æ°›å›´]
glowing pastel light, soft bloom effect, moonlit battlefield atmosphere

[Theme Styles / ä¸»é¢˜é£æ ¼]
fantasy Japanese setting, traditional haori fluttering, supernatural battle theme

[Rendering / æ¸²æŸ“æŠ€æœ¯]
hyper-detailed, 8K resolution, subsurface scattering for skin

[Effects / ç‰¹æ•ˆå…ƒç´ ]
floating cherry blossoms, glowing energy ribbons, heart-shaped sparks

[Typography & Overlay / æ–‡å­—ä¸è£…é¥°]
calligraphic kanji overlay ã€Œæ‹ã®å‘¼å¸ã€, dissolving brushstroke text, flowing mist captions"></textarea>
                </div>
                
                <div class="prompt-preview" id="promptPreview">
                    <!-- é¢„è§ˆåŒºåŸŸ -->
                </div>
            </div>
            
            <div class="import-controls">
                <input type="text" id="entryTitle" placeholder="ä¸ºè¿™ä¸ªæ¡ç›®èµ·ä¸ªåå­—..." class="entry-title-input">
                <input type="text" id="entryTags" placeholder="æ·»åŠ æ ‡ç­¾ï¼Œç”¨é€—å·åˆ†éš”..." class="entry-tags-input">
                <button class="btn" id="importBtn" disabled>ğŸ“¥ å¯¼å…¥æ¡ç›®</button>
                <button class="btn btn-secondary" id="clearBtn">ğŸ—‘ï¸ æ¸…ç©º</button>
                <button class="btn btn-secondary" id="addSampleBtn">â• æ·»åŠ ç¤ºä¾‹æ•°æ®</button>
            </div>
        </div>

        <!-- å·¥å…·æ  -->
        <div class="toolbar-section">
            <div class="toolbar-left">
                <h3>ğŸ” æœç´¢ & ç­›é€‰</h3>
                <div class="search-row">
                    <input type="text" class="search-input" id="searchInput" placeholder="æœç´¢æ ‡é¢˜ã€æ ‡ç­¾æˆ–æç¤ºè¯...">
                    <button class="btn" id="searchBtn">æœç´¢</button>
                    <button class="btn btn-secondary" id="resetBtn">é‡ç½®</button>
                </div>
                <div class="tag-filter" id="tagFilter">
                    <!-- æ ‡ç­¾ç­›é€‰å™¨å°†åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            <div class="toolbar-right">
                <h3>ğŸ“ æ•°æ®ç®¡ç†</h3>
                <div class="data-controls">
                    <button class="btn" id="exportBtn">ğŸ“¤ å¯¼å‡ºæ•°æ®</button>
                    <button class="btn" id="importDataBtn">ğŸ“¥ å¯¼å…¥æ•°æ®</button>
                    <button class="btn btn-secondary" id="openDataBtn">ğŸ“‚ æ‰“å¼€æ•°æ®ç›®å½•</button>
                </div>
            </div>
        </div>

        <!-- æ¡ç›®åˆ—è¡¨ -->
        <div class="entries-section">
            <div class="stats" id="stats">
                <!-- ç»Ÿè®¡ä¿¡æ¯å°†åŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <div class="entries-grid" id="entriesGrid">
                <!-- æ¡ç›®å¡ç‰‡å°†åŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <div class="pagination" id="pagination">
                <!-- åˆ†é¡µæ§ä»¶å°†åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- ç¼–è¾‘æ¨¡æ€æ¡† -->
        <div class="edit-modal" id="editModal">
            <div class="edit-content">
                <div class="edit-header">
                    <h2>ç¼–è¾‘æ¡ç›®</h2>
                    <button class="btn btn-secondary" onclick="closeEditModal()">âœ• å…³é—­</button>
                </div>
                
                <div class="tag-editor">
                    <h4>ğŸ·ï¸ æ ‡ç­¾ç®¡ç†</h4>
                    <div class="tags-container" id="editTags">
                        <!-- æ ‡ç­¾å°†åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" class="tag-input" id="newTagInput" placeholder="è¾“å…¥æ–°æ ‡ç­¾ï¼ŒæŒ‰å›è½¦æ·»åŠ ">
                        <button class="btn" onclick="addTag()">æ·»åŠ æ ‡ç­¾</button>
                    </div>
                </div>
                
                <div class="edit-categories" id="editCategories">
                    <!-- æç¤ºè¯ç±»åˆ«å°†åŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div class="edit-actions">
                    <button class="btn btn-danger" onclick="deleteEntry()">ğŸ—‘ï¸ åˆ é™¤æ¡ç›®</button>
                    <div>
                        <button class="btn copy-btn" onclick="copyAllPrompts()">ğŸ“‹ å¤åˆ¶å…¨éƒ¨è‹±æ–‡æç¤ºè¯</button>
                        <button class="btn" onclick="saveEntry()">ğŸ’¾ ä¿å­˜</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let entries = [];
        let filteredEntries = [];
        let currentPage = 1;
        const itemsPerPage = 12;
        let selectedCategories = new Set();
        let allTags = new Set();
        let selectedFiles = [];

        // 8å¤§ç±»åˆ«æ˜ å°„ï¼ˆç”¨äºæ­£åˆ™åŒ¹é…ï¼‰
        const categoryMapping = {
            'base_styles': {
                patterns: [/\[Base\s+Styles?\s*\/?\s*åŸºç¡€é£æ ¼?\]/, /\[åŸºç¡€é£æ ¼\s*\/?\s*Base\s+Styles?\]/],
                key: 'base_styles',
                name: 'ğŸ¨ åŸºç¡€é£æ ¼ (Base Styles)',
                zhName: 'åŸºç¡€é£æ ¼'
            },
            'artistic_styles': {
                patterns: [/\[Artistic\s+Styles?\s*\/?\s*ç”»é£è¡¨ç°?\]/, /\[ç”»é£è¡¨ç°\s*\/?\s*Artistic\s+Styles?\]/],
                key: 'artistic_styles', 
                name: 'ğŸ–Œï¸ ç”»é£è¡¨ç° (Artistic Styles)',
                zhName: 'ç”»é£è¡¨ç°'
            },
            'cinematic': {
                patterns: [/\[Cinematic\s*\/?\s*æ‘„å½±æ„Ÿ?\]/, /\[æ‘„å½±æ„Ÿ\s*\/?\s*Cinematic\]/],
                key: 'cinematic',
                name: 'ğŸ¬ æ‘„å½±æ„Ÿ (Cinematic)',
                zhName: 'æ‘„å½±æ„Ÿ'
            },
            'lighting_mood': {
                patterns: [/\[Lighting\s*&?\s*Mood\s*\/?\s*å…‰å½±æ°›å›´?\]/, /\[å…‰å½±æ°›å›´\s*\/?\s*Lighting\s*&?\s*Mood\]/],
                key: 'lighting_mood',
                name: 'ğŸ’¡ å…‰å½±æ°›å›´ (Lighting & Mood)',
                zhName: 'å…‰å½±æ°›å›´'
            },
            'theme_styles': {
                patterns: [/\[Theme\s+Styles?\s*\/?\s*ä¸»é¢˜é£æ ¼?\]/, /\[ä¸»é¢˜é£æ ¼\s*\/?\s*Theme\s+Styles?\]/],
                key: 'theme_styles',
                name: 'ğŸ® ä¸»é¢˜é£æ ¼ (Theme Styles)',
                zhName: 'ä¸»é¢˜é£æ ¼'
            },
            'rendering': {
                patterns: [/\[Rendering\s*\/?\s*æ¸²æŸ“æŠ€æœ¯?\]/, /\[æ¸²æŸ“æŠ€æœ¯\s*\/?\s*Rendering\]/],
                key: 'rendering',
                name: 'âš™ï¸ æ¸²æŸ“æŠ€æœ¯ (Rendering)',
                zhName: 'æ¸²æŸ“æŠ€æœ¯'
            },
            'effects': {
                patterns: [/\[Effects?\s*\/?\s*ç‰¹æ•ˆå…ƒç´ ?\]/, /\[ç‰¹æ•ˆå…ƒç´ \s*\/?\s*Effects?\]/],
                key: 'effects',
                name: 'âœ¨ ç‰¹æ•ˆå…ƒç´  (Effects)',
                zhName: 'ç‰¹æ•ˆå…ƒç´ '
            },
            'typography': {
                patterns: [/\[Typography\s*&?\s*Overlay\s*\/?\s*æ–‡å­—ä¸è£…é¥°?\]/, /\[æ–‡å­—ä¸è£…é¥°\s*\/?\s*Typography\s*&?\s*Overlay\]/],
                key: 'typography',
                name: 'ğŸ“ æ–‡å­—ä¸è£…é¥° (Typography & Overlay)',
                zhName: 'æ–‡å­—ä¸è£…é¥°'
            }
        };

        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', function() {
            // æ£€æŸ¥ API æ˜¯å¦æ­£ç¡®åŠ è½½
            console.log('Checking window.api:', window.api);
            if (!window.api) {
                console.error('window.api is not available! Preload script may have failed.');
                alert('åº”ç”¨åˆå§‹åŒ–å¤±è´¥ï¼šAPI ä¸å¯ç”¨ã€‚è¯·æ£€æŸ¥æ§åˆ¶å°é”™è¯¯ä¿¡æ¯ã€‚');
                return;
            }
            
            // æ£€æŸ¥å¿…è¦çš„ API æ–¹æ³•
            const requiredMethods = ['listEntries', 'saveEntries', 'saveMediaDataURL', 'resolveMediaURL', 'openUserData', 'exportJSON', 'importJSON'];
            const missingMethods = requiredMethods.filter(method => typeof window.api[method] !== 'function');
            
            if (missingMethods.length > 0) {
                console.error('Missing API methods:', missingMethods);
                alert(`ç¼ºå°‘å¿…è¦çš„APIæ–¹æ³•: ${missingMethods.join(', ')}`);
                return;
            }
            
            console.log('All APIs loaded successfully!');
            loadEntries();
            setupEventListeners();
        });

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // é€‰é¡¹å¡åˆ‡æ¢
            document.getElementById('imageTab').addEventListener('click', () => switchTab('image'));
            document.getElementById('promptTab').addEventListener('click', () => switchTab('prompt'));
            
            // æ–‡ä»¶ä¸Šä¼ 
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            const importBtn = document.getElementById('importBtn');
            const clearBtn = document.getElementById('clearBtn');
            const addSampleBtn = document.getElementById('addSampleBtn');

            // ç‚¹å‡»ä¸Šä¼ 
            uploadArea.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileSelect);
            
            // æ‹–æ‹½ä¸Šä¼  - æ·»åŠ åˆ°ä¸Šä¼ åŒºåŸŸå’Œæ•´ä¸ªå›¾ç‰‡é€‰é¡¹å¡
            const imageContent = document.getElementById('imageContent');
            
            [uploadArea, imageContent].forEach(element => {
                element.addEventListener('dragenter', handleDragEnter);
                element.addEventListener('dragover', handleDragOver);
                element.addEventListener('dragleave', handleDragLeave);
                element.addEventListener('drop', handleDrop);
            });
            
            // é˜²æ­¢æ•´ä¸ªçª—å£çš„æ‹–æ‹½é»˜è®¤è¡Œä¸º
            window.addEventListener('dragover', (e) => {
                e.preventDefault();
            });
            window.addEventListener('drop', (e) => {
                e.preventDefault();
            });
            
            // æç¤ºè¯è¾“å…¥
            const promptInput = document.getElementById('promptInput');
            promptInput.addEventListener('input', debounce(parsePrompts, 300));
            
            // æ ‡é¢˜å’Œæ ‡ç­¾è¾“å…¥
            document.getElementById('entryTitle').addEventListener('input', checkImportReady);
            document.getElementById('entryTags').addEventListener('input', checkImportReady);
            
            // æŒ‰é’®äº‹ä»¶
            importBtn.addEventListener('click', importEntry);
            clearBtn.addEventListener('click', clearAll);
            addSampleBtn.addEventListener('click', addSampleData);

            // æœç´¢
            document.getElementById('searchBtn').addEventListener('click', performSearch);
            document.getElementById('resetBtn').addEventListener('click', resetSearch);
            document.getElementById('searchInput').addEventListener('input', debounce(performSearch, 300));

            // æ•°æ®ç®¡ç†
            document.getElementById('exportBtn').addEventListener('click', exportData);
            document.getElementById('importDataBtn').addEventListener('click', importData);
            document.getElementById('openDataBtn').addEventListener('click', openDataDir);

            // ç¼–è¾‘æ¨¡æ€æ¡†
            document.getElementById('newTagInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addTag();
            });
        }

        // æ‹–æ‹½å¤„ç†
        function handleDragEnter(e) {
            e.preventDefault();
            e.stopPropagation();
            e.currentTarget.classList.add('dragover');
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
            e.dataTransfer.dropEffect = 'copy';
            e.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.stopPropagation();
            // åªæœ‰å½“é¼ æ ‡çœŸæ­£ç¦»å¼€å…ƒç´ ï¼ˆè€Œä¸æ˜¯ç§»åŠ¨åˆ°å­å…ƒç´ ï¼‰æ—¶æ‰ç§»é™¤æ ·å¼
            if (!e.currentTarget.contains(e.relatedTarget)) {
                e.currentTarget.classList.remove('dragover');
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            e.currentTarget.classList.remove('dragover');
            
            console.log('Drop event triggered');
            const files = Array.from(e.dataTransfer.files);
            console.log('All dropped files:', files);
            
            const imageFiles = files.filter(file => file.type.startsWith('image/'));
            console.log('Image files:', imageFiles);
            
            if (imageFiles.length > 0) {
                handleFiles(imageFiles);
            } else {
                alert('è¯·æ‹–æ‹½å›¾ç‰‡æ–‡ä»¶ï¼ˆPNG, JPG, JPEG, WebPï¼‰');
            }
        }

        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            handleFiles(files);
        }

        function handleFiles(files) {
            console.log('handleFiles called with:', files);
            if (files.length === 0) {
                console.log('No files provided');
                return;
            }
            
            selectedFiles = files;
            console.log('Files stored in selectedFiles:', selectedFiles);
            checkImportReady();
            
            // æ›´æ–°ä¸Šä¼ åŒºåŸŸæ˜¾ç¤º
            const uploadArea = document.getElementById('uploadArea');
            uploadArea.innerHTML = `
                <div class="upload-icon">âœ…</div>
                <p>å·²é€‰æ‹© ${files.length} ä¸ªæ–‡ä»¶</p>
                <p style="font-size: 0.9rem; color: #6c757d; margin-top: 10px;">
                    ${files.map(f => f.name).join(', ')}
                </p>
                <p style="font-size: 0.8rem; color: #6c757d; margin-top: 5px;">
                    ç‚¹å‡»é‡æ–°é€‰æ‹©æ–‡ä»¶
                </p>
            `;
            
            console.log('Upload area updated');
        }

        // é€‰é¡¹å¡åˆ‡æ¢
        function switchTab(tab) {
            // æ›´æ–°é€‰é¡¹å¡æŒ‰é’®
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            if (tab === 'image') {
                document.getElementById('imageTab').classList.add('active');
                document.getElementById('imageContent').classList.add('active');
            } else {
                document.getElementById('promptTab').classList.add('active');
                document.getElementById('promptContent').classList.add('active');
            }
            
            checkImportReady();
        }

        // è§£ææç¤ºè¯æ–‡æœ¬
        function parsePrompts() {
            const promptText = document.getElementById('promptInput').value;
            const preview = document.getElementById('promptPreview');
            
            if (!promptText.trim()) {
                preview.innerHTML = '<p class="empty">è¯·è¾“å…¥æç¤ºè¯æ–‡æœ¬...</p>';
                preview.className = 'prompt-preview empty';
                checkImportReady();
                return;
            }
            
            const parsedPrompts = parsePromptText(promptText);
            
            if (Object.keys(parsedPrompts).length === 0) {
                preview.innerHTML = '<p class="empty">æœªæ£€æµ‹åˆ°æœ‰æ•ˆçš„åˆ†ç±»æ ‡ç­¾ï¼Œè¯·æ£€æŸ¥æ ¼å¼...</p>';
                preview.className = 'prompt-preview empty';
                checkImportReady();
                return;
            }
            
            // æ˜¾ç¤ºé¢„è§ˆ
            preview.className = 'prompt-preview';
            preview.innerHTML = Object.entries(parsedPrompts).map(([key, data]) => `
                <div class="preview-category">
                    <h4>${data.categoryName}</h4>
                    <div class="en-text">${data.content}</div>
                    <div class="zh-text">${data.categoryZh}</div>
                </div>
            `).join('');
            
            checkImportReady();
        }

        // æç¤ºè¯æ–‡æœ¬è§£æå‡½æ•°
        function parsePromptText(text) {
            const result = {};
            
            // æŒ‰è¡Œåˆ†å‰²æ–‡æœ¬
            const lines = text.split('\n');
            let currentCategory = null;
            let currentContent = [];
            
            for (let line of lines) {
                line = line.trim();
                if (!line) continue;
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯åˆ†ç±»æ ‡é¢˜
                let foundCategory = null;
                for (const [key, mapping] of Object.entries(categoryMapping)) {
                    for (const pattern of mapping.patterns) {
                        if (pattern.test(line)) {
                            foundCategory = key;
                            break;
                        }
                    }
                    if (foundCategory) break;
                }
                
                if (foundCategory) {
                    // ä¿å­˜ä¹‹å‰çš„åˆ†ç±»å†…å®¹
                    if (currentCategory && currentContent.length > 0) {
                        result[currentCategory] = {
                            content: currentContent.join(', '),
                            categoryName: categoryMapping[currentCategory].name,
                            categoryZh: categoryMapping[currentCategory].zhName
                        };
                    }
                    
                    // å¼€å§‹æ–°çš„åˆ†ç±»
                    currentCategory = foundCategory;
                    currentContent = [];
                } else if (currentCategory && line) {
                    // æ·»åŠ åˆ°å½“å‰åˆ†ç±»çš„å†…å®¹
                    currentContent.push(line);
                }
            }
            
            // ä¿å­˜æœ€åä¸€ä¸ªåˆ†ç±»
            if (currentCategory && currentContent.length > 0) {
                result[currentCategory] = {
                    content: currentContent.join(', '),
                    categoryName: categoryMapping[currentCategory].name,
                    categoryZh: categoryMapping[currentCategory].zhName
                };
            }
            
            return result;
        }

        // æ£€æŸ¥æ˜¯å¦å¯ä»¥å¯¼å…¥
        function checkImportReady() {
            const importBtn = document.getElementById('importBtn');
            const hasImage = selectedFiles.length > 0;
            const hasPrompts = document.getElementById('promptInput').value.trim().length > 0;
            const hasTitle = document.getElementById('entryTitle').value.trim().length > 0;
            
            importBtn.disabled = !hasImage || !hasPrompts || !hasTitle;
        }

        // ç±»åˆ«é€‰æ‹©
        function toggleCategory(item) {
            const category = item.dataset.category;
            if (selectedCategories.has(category)) {
                selectedCategories.delete(category);
                item.classList.remove('selected');
            } else {
                selectedCategories.add(category);
                item.classList.add('selected');
            }
        }

        // å¯¼å…¥æ¡ç›®
        async function importEntry() {
            const title = document.getElementById('entryTitle').value.trim();
            const tagsInput = document.getElementById('entryTags').value.trim();
            const promptText = document.getElementById('promptInput').value.trim();
            
            console.log('å¼€å§‹å¯¼å…¥:', { title, tagsInput, promptText: promptText.slice(0, 100) + '...', filesCount: selectedFiles.length });
            
            if (!title) {
                alert('è¯·è¾“å…¥æ¡ç›®æ ‡é¢˜ï¼');
                return;
            }

            if (selectedFiles.length === 0) {
                alert('è¯·å…ˆé€‰æ‹©å›¾ç‰‡æ–‡ä»¶ï¼');
                return;
            }

            if (!promptText) {
                alert('è¯·è¾“å…¥æç¤ºè¯æ–‡æœ¬ï¼');
                return;
            }

            try {
                const parsedPrompts = parsePromptText(promptText);
                console.log('è§£æåçš„æç¤ºè¯:', parsedPrompts);
                
                if (Object.keys(parsedPrompts).length === 0) {
                    alert('æœªæ£€æµ‹åˆ°æœ‰æ•ˆçš„æç¤ºè¯åˆ†ç±»ï¼Œè¯·æ£€æŸ¥æ ¼å¼ï¼\n\nè¯·ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„åˆ†ç±»æ ‡ç­¾æ ¼å¼ï¼Œä¾‹å¦‚ï¼š\n[Base Styles / åŸºç¡€é£æ ¼]\n[Artistic Styles / ç”»é£è¡¨ç°]\nç­‰ç­‰...');
                    return;
                }

                // å¤„ç†æ ‡ç­¾
                const tags = tagsInput ? tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag) : [];
                console.log('å¤„ç†åçš„æ ‡ç­¾:', tags);
                
                for (let i = 0; i < selectedFiles.length; i++) {
                    const file = selectedFiles[i];
                    console.log(`å¤„ç†æ–‡ä»¶ ${i + 1}/${selectedFiles.length}:`, file.name);
                    
                    // è¯»å–æ–‡ä»¶ä¸º Data URL
                    const dataUrl = await fileToDataURL(file);
                    console.log('æ–‡ä»¶è¯»å–å®Œæˆï¼Œå¤§å°:', dataUrl.length);
                    
                    // ä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°
                    const filenameBase = `img_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                    console.log('ä¿å­˜å›¾ç‰‡æ–‡ä»¶å:', filenameBase);
                    
                    const mediaResult = await window.api.saveMediaDataURL({ dataUrl, filenameBase });
                    console.log('å›¾ç‰‡ä¿å­˜ç»“æœ:', mediaResult);
                    
                    if (!mediaResult.ok) {
                        throw new Error(mediaResult.error || 'ä¿å­˜å›¾ç‰‡å¤±è´¥');
                    }
                    
                    // åˆ›å»ºæ–°æ¡ç›®
                    const newEntry = {
                        id: Date.now() + Math.random() + i,
                        title: selectedFiles.length === 1 ? title : `${title} - ${file.name.replace(/\.[^/.]+$/, "")}`,
                        imagePath: mediaResult.path,
                        tags: [...tags, 'å¯¼å…¥'],
                        prompts: {},
                        createdAt: new Date().toISOString()
                    };

                    // è½¬æ¢è§£æåçš„æç¤ºè¯æ ¼å¼
                    Object.entries(parsedPrompts).forEach(([key, data]) => {
                        newEntry.prompts[key] = {
                            en: data.content,
                            zh: data.categoryZh
                        };
                    });

                    console.log('åˆ›å»ºçš„æ¡ç›®:', newEntry);
                    entries.unshift(newEntry);
                }
                
                console.log('ä¿å­˜æ¡ç›®åˆ°æ•°æ®åº“...');
                await saveEntries();
                console.log('æ›´æ–° filteredEntries...');
                filteredEntries = [...entries];  // é‡è¦ï¼šæ›´æ–°è¿‡æ»¤æ•°ç»„
                console.log('æ›´æ–°æ˜¾ç¤º...');
                updateDisplay();
                clearAll();
                showMessage('æˆåŠŸå¯¼å…¥ ' + selectedFiles.length + ' ä¸ªæ¡ç›®ï¼');
                
            } catch (error) {
                console.error('å¯¼å…¥å¤±è´¥è¯¦ç»†é”™è¯¯:', error);
                alert(`å¯¼å…¥å¤±è´¥: ${error.message}\n\nè¯·æ£€æŸ¥æ§åˆ¶å°è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯ã€‚`);
            }
        }

        // æ·»åŠ ç¤ºä¾‹æ•°æ®
        function addSampleData() {
            const sampleEntries = [
                {
                    id: Date.now() + 1,
                    title: "åŠ¨æ¼«å¥³å­©ç¤ºä¾‹",
                    imagePath: createPlaceholderImage("ç¤ºä¾‹å›¾ç‰‡ 1"),
                    tags: ['ç¤ºä¾‹', 'åŠ¨æ¼«', 'å¥³å­©'],
                    prompts: {
                        base_styles: {
                            en: "anime style, bishoujo character, Demon Slayer illustration",
                            zh: "åŸºç¡€é£æ ¼"
                        },
                        artistic_styles: {
                            en: "cel shading, manga lineart, vibrant pastel tones",
                            zh: "ç”»é£è¡¨ç°"
                        },
                        rendering: {
                            en: "hyper-detailed, 8K resolution, subsurface scattering for skin",
                            zh: "æ¸²æŸ“æŠ€æœ¯"
                        }
                    },
                    createdAt: new Date().toISOString()
                },
                {
                    id: Date.now() + 2,
                    title: "æˆ˜æ–—åœºæ™¯ç¤ºä¾‹", 
                    imagePath: createPlaceholderImage("ç¤ºä¾‹å›¾ç‰‡ 2"),
                    tags: ['ç¤ºä¾‹', 'æˆ˜æ–—', 'ç‰¹æ•ˆ'],
                    prompts: {
                        cinematic: {
                            en: "cinematic composition, dynamic action shot, ultra-realistic rim lighting",
                            zh: "æ‘„å½±æ„Ÿ"
                        },
                        lighting_mood: {
                            en: "glowing pastel light, soft bloom effect, moonlit battlefield atmosphere",
                            zh: "å…‰å½±æ°›å›´"
                        },
                        effects: {
                            en: "floating cherry blossoms, glowing energy ribbons, heart-shaped sparks",
                            zh: "ç‰¹æ•ˆå…ƒç´ "
                        }
                    },
                    createdAt: new Date().toISOString()
                }
            ];
            
            entries.unshift(...sampleEntries);
            filteredEntries = [...entries];  // é‡è¦ï¼šæ›´æ–°è¿‡æ»¤æ•°ç»„
            saveEntries();
            updateDisplay();
            showMessage('å·²æ·»åŠ ç¤ºä¾‹æ•°æ®ï¼');
        }

        // æ¸…ç©ºæ‰€æœ‰
        function clearAll() {
            selectedFiles = [];
            document.getElementById('fileInput').value = '';
            document.getElementById('entryTitle').value = '';
            document.getElementById('entryTags').value = '';
            document.getElementById('promptInput').value = '';
            document.getElementById('importBtn').disabled = true;
            
            // é‡ç½®ä¸Šä¼ åŒºåŸŸ
            const uploadArea = document.getElementById('uploadArea');
            uploadArea.innerHTML = `
                <div class="upload-icon">ğŸ“</div>
                <p>æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
                <p style="font-size: 0.9rem; color: #6c757d; margin-top: 10px;">
                    æ”¯æŒ PNG, JPG, JPEG, WebP æ ¼å¼
                </p>
            `;
            
            // é‡ç½®é¢„è§ˆåŒºåŸŸ
            const preview = document.getElementById('promptPreview');
            preview.innerHTML = '<p class="empty">è¯·è¾“å…¥æç¤ºè¯æ–‡æœ¬...</p>';
            preview.className = 'prompt-preview empty';
        }

        // æœç´¢åŠŸèƒ½
        function performSearch() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const selectedTags = Array.from(document.querySelectorAll('.tag.selected')).map(tag => tag.textContent);
            
            filteredEntries = entries.filter(entry => {
                const matchesSearch = !searchTerm || 
                    entry.title.toLowerCase().includes(searchTerm) ||
                    entry.tags.some(tag => tag.toLowerCase().includes(searchTerm)) ||
                    Object.values(entry.prompts).some(prompt => 
                        prompt.en.toLowerCase().includes(searchTerm) ||
                        prompt.zh.toLowerCase().includes(searchTerm)
                    );
                
                const matchesTags = selectedTags.length === 0 || 
                    selectedTags.some(tag => entry.tags.includes(tag));
                
                return matchesSearch && matchesTags;
            });
            
            currentPage = 1;
            updateDisplay();
        }

        function resetSearch() {
            document.getElementById('searchInput').value = '';
            document.querySelectorAll('.tag.selected').forEach(tag => tag.classList.remove('selected'));
            filteredEntries = [...entries];
            currentPage = 1;
            updateDisplay();
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            console.log('updateDisplay called');
            console.log('entries.length:', entries.length);
            console.log('filteredEntries.length:', filteredEntries.length);
            console.log('Current entries:', entries);
            console.log('Current filteredEntries:', filteredEntries);
            
            updateStats();
            updateEntriesGrid();
            updatePagination();
            updateTagFilter();
        }

        function updateStats() {
            const stats = document.getElementById('stats');
            const totalPages = Math.ceil(filteredEntries.length / itemsPerPage);
            stats.innerHTML = `
                <strong>æ€»æ¡ç›®: ${entries.length}</strong> | 
                <strong>å½“å‰æ˜¾ç¤º: ${filteredEntries.length}</strong> | 
                <strong>ç¬¬ ${currentPage} é¡µï¼Œå…± ${totalPages} é¡µ</strong>
            `;
        }

        function updateEntriesGrid() {
            const grid = document.getElementById('entriesGrid');
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageEntries = filteredEntries.slice(startIndex, endIndex);

            if (pageEntries.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <h3>æš‚æ— æ•°æ®</h3>
                        <p>ä¸Šä¼ ä¸€äº›å›¾ç‰‡å¹¶ç”Ÿæˆæç¤ºè¯æ¥å¼€å§‹ä½¿ç”¨å§ï¼</p>
                        <p>æˆ–è€…ç‚¹å‡»"æ·»åŠ ç¤ºä¾‹æ•°æ®"æ¥æŸ¥çœ‹æ•ˆæœã€‚</p>
                    </div>
                `;
                return;
            }

            console.log('Rendering entries:', pageEntries.length, 'entries');
            
            grid.innerHTML = pageEntries.map(entry => {
                console.log('Rendering entry:', entry.title, 'with prompts:', Object.keys(entry.prompts));
                return `
                <div class="entry-card">
                    <img src="${resolveImagePath(entry.imagePath)}" alt="${entry.title}" class="entry-image" onerror="this.src='${createPlaceholderImage(entry.title)}'">
                    <div class="entry-content">
                        <div class="entry-title">${entry.title}</div>
                        <div class="entry-tags">
                            ${entry.tags.map(tag => `<span class="entry-tag">${tag}</span>`).join('')}
                        </div>
                        ${Object.entries(entry.prompts).map(([category, prompt]) => `
                            <div class="prompt-section">
                                <div class="prompt-category">${getCategoryName(category)}</div>
                                <div class="prompt-text" onclick="copyToClipboard('${escapeHtml(prompt.en)}')" title="ç‚¹å‡»å¤åˆ¶è‹±æ–‡æç¤ºè¯">${prompt.en}</div>
                                <div class="prompt-chinese">${prompt.zh}</div>
                            </div>
                        `).join('')}
                        <div style="margin-top: 15px; display: flex; gap: 10px;">
                            <button class="btn" onclick="editEntry('${entry.id}')">âœï¸ ç¼–è¾‘</button>
                            <button class="copy-btn" onclick="copyAllPromptsForEntry('${entry.id}')">ğŸ“‹ å¤åˆ¶å…¨éƒ¨</button>
                        </div>
                    </div>
                </div>
                `;
            }).join('');
        }

        function updatePagination() {
            const pagination = document.getElementById('pagination');
            const totalPages = Math.ceil(filteredEntries.length / itemsPerPage);
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }

            let paginationHTML = '';
            
            // ä¸Šä¸€é¡µ
            if (currentPage > 1) {
                paginationHTML += `<button class="page-btn" onclick="goToPage(${currentPage - 1})">ä¸Šä¸€é¡µ</button>`;
            }
            
            // é¡µç 
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    paginationHTML += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})">${i}</button>`;
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    paginationHTML += `<span class="page-btn">...</span>`;
                }
            }
            
            // ä¸‹ä¸€é¡µ
            if (currentPage < totalPages) {
                paginationHTML += `<button class="page-btn" onclick="goToPage(${currentPage + 1})">ä¸‹ä¸€é¡µ</button>`;
            }
            
            pagination.innerHTML = paginationHTML;
        }

        function updateTagFilter() {
            // æ”¶é›†æ‰€æœ‰æ ‡ç­¾
            allTags.clear();
            entries.forEach(entry => {
                entry.tags.forEach(tag => allTags.add(tag));
            });

            const tagFilter = document.getElementById('tagFilter');
            if (allTags.size > 0) {
                tagFilter.innerHTML = Array.from(allTags).map(tag => 
                    `<span class="tag" onclick="toggleTag(this)">${tag}</span>`
                ).join('');
            } else {
                tagFilter.innerHTML = '<p style="color: #6c757d;">æš‚æ— æ ‡ç­¾</p>';
            }
        }

        // å·¥å…·å‡½æ•°
        function toggleTag(tagElement) {
            tagElement.classList.toggle('selected');
            performSearch();
        }

        function goToPage(page) {
            currentPage = page;
            updateDisplay();
        }

        function getCategoryName(category) {
            return categoryMapping[category]?.name || category;
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showMessage('æç¤ºè¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
            });
        }

        function showMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'success-message';
            messageDiv.textContent = message;
            document.querySelector('.container').insertBefore(messageDiv, document.querySelector('.upload-section'));
            
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function createPlaceholderImage(text) {
            return `data:image/svg+xml;base64,${btoa(`
                <svg width="300" height="200" xmlns="http://www.w3.org/2000/svg">
                    <rect width="100%" height="100%" fill="#f8f9fa"/>
                    <text x="50%" y="50%" font-family="Arial" font-size="14" fill="#6c757d" text-anchor="middle" dy=".3em">${text}</text>
                </svg>
            `)}`;
        }

        function fileToDataURL(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = e => resolve(e.target.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // æ•°æ®æŒä¹…åŒ–
        async function loadEntries() {
            try {
                console.log('Loading entries from API...');
                const data = await window.api.listEntries();
                console.log('Loaded data from API:', data);
                
                entries = Array.isArray(data) ? data : [];
                filteredEntries = [...entries];
                
                console.log('Set entries:', entries.length);
                console.log('Set filteredEntries:', filteredEntries.length);
                
                updateDisplay();
            } catch (error) {
                console.error('Failed to load entries:', error);
                entries = [];
                filteredEntries = [];
                updateDisplay();
            }
        }

        async function saveEntries() {
            try {
                await window.api.saveEntries(entries);
            } catch (error) {
                console.error('Failed to save entries:', error);
            }
        }

        // å›¾ç‰‡è·¯å¾„è§£æ
        function resolveImagePath(imagePath) {
            if (imagePath.startsWith('file://') || imagePath.startsWith('data:')) {
                return imagePath;
            }
            // å¯¹äºç›¸å¯¹è·¯å¾„ï¼Œéœ€è¦é€šè¿‡APIè§£æ
            return imagePath;
        }

        // ç¼–è¾‘æ¡ç›®
        let currentEditingEntry = null;

        function editEntry(entryId) {
            const entry = entries.find(e => e.id == entryId);
            if (!entry) return;
            
            currentEditingEntry = entry;
            
            // æ˜¾ç¤ºæ ‡ç­¾
            updateEditTags();
            
            // æ˜¾ç¤ºæç¤ºè¯ç±»åˆ«
            updateEditCategories();
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            document.getElementById('editModal').classList.add('active');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('active');
            currentEditingEntry = null;
        }

        function updateEditTags() {
            if (!currentEditingEntry) return;
            
            const container = document.getElementById('editTags');
            container.innerHTML = currentEditingEntry.tags.map(tag => `
                <div class="tag-chip">
                    ${tag}
                    <button class="tag-remove" onclick="removeTag('${tag}')">Ã—</button>
                </div>
            `).join('');
        }

        function updateEditCategories() {
            if (!currentEditingEntry) return;
            
            const container = document.getElementById('editCategories');
            container.innerHTML = Object.entries(currentEditingEntry.prompts).map(([category, prompt]) => `
                <div class="edit-category">
                    <h4>${getCategoryName(category)}</h4>
                    <textarea class="edit-textarea" data-category="${category}" data-lang="en">${prompt.en}</textarea>
                    <div class="edit-zh">ä¸­æ–‡è¯´æ˜: ${prompt.zh}</div>
                    <div class="copy-buttons">
                        <button class="copy-btn" onclick="copyToClipboard('${escapeHtml(prompt.en)}')">å¤åˆ¶è‹±æ–‡</button>
                    </div>
                </div>
            `).join('');
        }

        function addTag() {
            const input = document.getElementById('newTagInput');
            const tag = input.value.trim();
            
            if (tag && !currentEditingEntry.tags.includes(tag)) {
                currentEditingEntry.tags.push(tag);
                updateEditTags();
                input.value = '';
            }
        }

        function removeTag(tag) {
            if (!currentEditingEntry) return;
            currentEditingEntry.tags = currentEditingEntry.tags.filter(t => t !== tag);
            updateEditTags();
        }

        function saveEntry() {
            if (!currentEditingEntry) return;
            
            // æ›´æ–°æç¤ºè¯å†…å®¹
            const textareas = document.querySelectorAll('.edit-textarea');
            textareas.forEach(textarea => {
                const category = textarea.dataset.category;
                const lang = textarea.dataset.lang;
                if (currentEditingEntry.prompts[category]) {
                    currentEditingEntry.prompts[category][lang] = textarea.value;
                }
            });
            
            filteredEntries = [...entries];  // é‡è¦ï¼šæ›´æ–°è¿‡æ»¤æ•°ç»„
            saveEntries();
            updateDisplay();
            closeEditModal();
            showMessage('æ¡ç›®å·²ä¿å­˜ï¼');
        }

        function deleteEntry() {
            if (!currentEditingEntry) return;
            
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ¡ç›®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {
                entries = entries.filter(e => e.id !== currentEditingEntry.id);
                filteredEntries = [...entries];  // é‡è¦ï¼šæ›´æ–°è¿‡æ»¤æ•°ç»„
                saveEntries();
                updateDisplay();
                closeEditModal();
                showMessage('æ¡ç›®å·²åˆ é™¤ï¼');
            }
        }

        function copyAllPrompts() {
            if (!currentEditingEntry) return;
            
            const allPrompts = Object.values(currentEditingEntry.prompts)
                .map(prompt => prompt.en)
                .join(', ');
            
            copyToClipboard(allPrompts);
        }

        function copyAllPromptsForEntry(entryId) {
            const entry = entries.find(e => e.id == entryId);
            if (!entry) return;
            
            const allPrompts = Object.values(entry.prompts)
                .map(prompt => prompt.en)
                .join(', ');
            
            copyToClipboard(allPrompts);
        }

        // æ•°æ®ç®¡ç†åŠŸèƒ½
        async function exportData() {
            try {
                const result = await window.api.exportJSON(entries);
                if (result.ok) {
                    showMessage(`æ•°æ®å·²å¯¼å‡ºåˆ°: ${result.path}`);
                } else {
                    alert('å¯¼å‡ºå¤±è´¥: ' + result.error);
                }
            } catch (error) {
                console.error('Export error:', error);
                alert('å¯¼å‡ºå¤±è´¥: ' + error.message);
            }
        }

        async function importData() {
            try {
                const result = await window.api.importJSON();
                if (result.ok) {
                    if (confirm('å¯¼å…¥æ•°æ®å°†è¦†ç›–å½“å‰æ‰€æœ‰æ•°æ®ï¼Œç¡®å®šç»§ç»­å—ï¼Ÿ')) {
                        entries = Array.isArray(result.data) ? result.data : [];
                        filteredEntries = [...entries];  // ç¡®ä¿è¿‡æ»¤æ•°ç»„åŒæ­¥
                        await saveEntries();
                        updateDisplay();
                        showMessage('æ•°æ®å¯¼å…¥æˆåŠŸï¼');
                    }
                } else if (result.error !== 'Cancelled') {
                    alert('å¯¼å…¥å¤±è´¥: ' + result.error);
                }
            } catch (error) {
                console.error('Import error:', error);
                alert('å¯¼å…¥å¤±è´¥: ' + error.message);
            }
        }

        async function openDataDir() {
            try {
                await window.api.openUserData();
            } catch (error) {
                console.error('Open directory error:', error);
                alert('æ— æ³•æ‰“å¼€æ•°æ®ç›®å½•: ' + error.message);
            }
        }
    </script>
</body>
</html>
